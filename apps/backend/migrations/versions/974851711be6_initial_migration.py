"""Initial migration

Revision ID: 974851711be6
Revises: 
Create Date: 2025-07-14 05:24:02.987310

"""
from alembic import op
import sqlalchemy as sa
from sqlalchemy.dialects import postgresql

# revision identifiers, used by Alembic.
revision = '974851711be6'
down_revision = None
branch_labels = None
depends_on = None


def upgrade():
    # ### commands auto generated by Alembic - please adjust! ###
    op.create_table('blacklist_tokens',
    sa.Column('id', sa.Integer(), nullable=False),
    sa.Column('jti', sa.String(length=120), nullable=False),
    sa.Column('created_at', sa.DateTime(), nullable=False),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('jti')
    )
    op.create_table('language_metrics',
    sa.Column('id', sa.Integer(), nullable=False),
    sa.Column('language_code', sa.String(length=10), nullable=False),
    sa.Column('date', sa.Date(), nullable=False),
    sa.Column('total_words_processed', sa.Integer(), nullable=False),
    sa.Column('unique_words_discovered', sa.Integer(), nullable=False),
    sa.Column('out_of_vocabulary_words', sa.Integer(), nullable=False),
    sa.Column('average_word_length', sa.Float(), nullable=True),
    sa.Column('average_sentence_length', sa.Float(), nullable=True),
    sa.Column('diacritics_detected', sa.Integer(), nullable=False),
    sa.Column('diacritics_correctly_placed', sa.Integer(), nullable=False),
    sa.Column('morphological_variants_detected', sa.Integer(), nullable=False),
    sa.Column('proper_nouns_detected', sa.Integer(), nullable=False),
    sa.Column('technical_terms_detected', sa.Integer(), nullable=False),
    sa.Column('character_accuracy', sa.Float(), nullable=True),
    sa.Column('word_accuracy', sa.Float(), nullable=True),
    sa.Column('sentence_accuracy', sa.Float(), nullable=True),
    sa.Column('semantic_accuracy', sa.Float(), nullable=True),
    sa.Column('phoneme_accuracy', sa.Float(), nullable=True),
    sa.Column('stress_pattern_accuracy', sa.Float(), nullable=True),
    sa.Column('syllable_boundary_accuracy', sa.Float(), nullable=True),
    sa.Column('frequent_error_patterns', postgresql.JSONB(astext_type=sa.Text()), nullable=True),
    sa.Column('challenging_phonemes', postgresql.JSONB(astext_type=sa.Text()), nullable=True),
    sa.Column('improvement_suggestions', postgresql.JSONB(astext_type=sa.Text()), nullable=True),
    sa.Column('data_metadata', postgresql.JSONB(astext_type=sa.Text()), nullable=True),
    sa.Column('created_at', sa.DateTime(), nullable=False),
    sa.Column('updated_at', sa.DateTime(), nullable=False),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('language_code', 'date', name='uq_language_metrics_lang_date')
    )
    op.create_table('model_performance',
    sa.Column('id', sa.Integer(), nullable=False),
    sa.Column('model_name', sa.String(length=100), nullable=False),
    sa.Column('date', sa.Date(), nullable=False),
    sa.Column('language', sa.String(length=10), nullable=False),
    sa.Column('usage_count', sa.Integer(), nullable=False),
    sa.Column('success_count', sa.Integer(), nullable=False),
    sa.Column('failure_count', sa.Integer(), nullable=False),
    sa.Column('average_wer', sa.Float(), nullable=True),
    sa.Column('average_cer', sa.Float(), nullable=True),
    sa.Column('average_processing_time', sa.Float(), nullable=True),
    sa.Column('average_confidence', sa.Float(), nullable=True),
    sa.Column('diacritic_accuracy', sa.Float(), nullable=True),
    sa.Column('morphology_accuracy', sa.Float(), nullable=True),
    sa.Column('proper_noun_accuracy', sa.Float(), nullable=True),
    sa.Column('technical_term_accuracy', sa.Float(), nullable=True),
    sa.Column('average_audio_duration', sa.Float(), nullable=True),
    sa.Column('audio_quality_score', sa.Float(), nullable=True),
    sa.Column('background_noise_level', sa.Float(), nullable=True),
    sa.Column('average_memory_usage', sa.Float(), nullable=True),
    sa.Column('average_cpu_usage', sa.Float(), nullable=True),
    sa.Column('average_gpu_usage', sa.Float(), nullable=True),
    sa.Column('common_errors', postgresql.JSONB(astext_type=sa.Text()), nullable=True),
    sa.Column('error_patterns', postgresql.JSONB(astext_type=sa.Text()), nullable=True),
    sa.Column('data_metadata', postgresql.JSONB(astext_type=sa.Text()), nullable=True),
    sa.Column('created_at', sa.DateTime(), nullable=False),
    sa.Column('updated_at', sa.DateTime(), nullable=False),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('model_name', 'date', 'language', name='uq_model_performance_unique')
    )
    op.create_table('system_analytics',
    sa.Column('id', sa.Integer(), nullable=False),
    sa.Column('date', sa.Date(), nullable=False),
    sa.Column('total_users', sa.Integer(), nullable=False),
    sa.Column('active_users', sa.Integer(), nullable=False),
    sa.Column('new_users', sa.Integer(), nullable=False),
    sa.Column('verified_users', sa.Integer(), nullable=False),
    sa.Column('total_transcriptions', sa.Integer(), nullable=False),
    sa.Column('successful_transcriptions', sa.Integer(), nullable=False),
    sa.Column('failed_transcriptions', sa.Integer(), nullable=False),
    sa.Column('total_processing_time', sa.Float(), nullable=False),
    sa.Column('total_audio_hours', sa.Float(), nullable=False),
    sa.Column('whisper_usage', sa.Integer(), nullable=False),
    sa.Column('wav2vec_usage', sa.Integer(), nullable=False),
    sa.Column('comparison_usage', sa.Integer(), nullable=False),
    sa.Column('average_whisper_wer', sa.Float(), nullable=True),
    sa.Column('average_wav2vec_wer', sa.Float(), nullable=True),
    sa.Column('voice_notes_created', sa.Integer(), nullable=False),
    sa.Column('research_exports', sa.Integer(), nullable=False),
    sa.Column('academic_reports_generated', sa.Integer(), nullable=False),
    sa.Column('average_response_time', sa.Float(), nullable=True),
    sa.Column('system_uptime_percentage', sa.Float(), nullable=True),
    sa.Column('peak_concurrent_users', sa.Integer(), nullable=True),
    sa.Column('greek_transcription_accuracy', sa.Float(), nullable=True),
    sa.Column('diacritic_accuracy', sa.Float(), nullable=True),
    sa.Column('morphology_accuracy', sa.Float(), nullable=True),
    sa.Column('error_count', sa.Integer(), nullable=False),
    sa.Column('error_types', postgresql.JSONB(astext_type=sa.Text()), nullable=True),
    sa.Column('data_metadata', postgresql.JSONB(astext_type=sa.Text()), nullable=True),
    sa.Column('created_at', sa.DateTime(), nullable=False),
    sa.Column('updated_at', sa.DateTime(), nullable=False),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('date')
    )
    op.create_table('users',
    sa.Column('email', sa.String(length=120), nullable=False),
    sa.Column('username', sa.String(length=80), nullable=False),
    sa.Column('password_hash', sa.String(length=255), nullable=False),
    sa.Column('email_verified', sa.Boolean(), nullable=True),
    sa.Column('first_name', sa.String(length=50), nullable=False),
    sa.Column('last_name', sa.String(length=50), nullable=False),
    sa.Column('phone', sa.String(length=20), nullable=True),
    sa.Column('organization', sa.String(length=100), nullable=True),
    sa.Column('institution', sa.String(length=200), nullable=True),
    sa.Column('research_focus', sa.String(length=500), nullable=True),
    sa.Column('academic_level', sa.String(length=50), nullable=True),
    sa.Column('thesis_title', sa.String(length=300), nullable=True),
    sa.Column('academic_year', sa.String(length=20), nullable=True),
    sa.Column('id', sa.Integer(), nullable=False),
    sa.Column('is_active', sa.Boolean(), nullable=False),
    sa.Column('is_deleted', sa.Boolean(), nullable=False),
    sa.Column('created_at', sa.DateTime(), nullable=False),
    sa.Column('updated_at', sa.DateTime(), nullable=False),
    sa.Column('created_by_id', sa.Integer(), nullable=True),
    sa.Column('updated_by_id', sa.Integer(), nullable=True),
    sa.Column('created_by_email', sa.String(length=255), nullable=True),
    sa.Column('updated_by_email', sa.String(length=255), nullable=True),
    sa.ForeignKeyConstraint(['created_by_id'], ['users.id'], ),
    sa.ForeignKeyConstraint(['updated_by_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('email'),
    sa.UniqueConstraint('username')
    )
    op.create_table('audio_files',
    sa.Column('original_filename', sa.String(length=255), nullable=False),
    sa.Column('stored_filename', sa.String(length=255), nullable=False),
    sa.Column('file_path', sa.String(length=500), nullable=False),
    sa.Column('file_size', sa.BigInteger(), nullable=False),
    sa.Column('file_hash', sa.String(length=64), nullable=False),
    sa.Column('mime_type', sa.String(length=100), nullable=False),
    sa.Column('duration_seconds', sa.Float(), nullable=True),
    sa.Column('sample_rate', sa.Integer(), nullable=True),
    sa.Column('channels', sa.Integer(), nullable=True),
    sa.Column('bitrate', sa.Integer(), nullable=True),
    sa.Column('user_id', sa.Integer(), nullable=False),
    sa.Column('status', sa.String(length=50), nullable=True),
    sa.Column('source_url', sa.Text(), nullable=True),
    sa.Column('video_metadata', sa.JSON(), nullable=True),
    sa.Column('id', sa.Integer(), nullable=False),
    sa.Column('is_active', sa.Boolean(), nullable=False),
    sa.Column('is_deleted', sa.Boolean(), nullable=False),
    sa.Column('created_at', sa.DateTime(), nullable=False),
    sa.Column('updated_at', sa.DateTime(), nullable=False),
    sa.Column('created_by_id', sa.Integer(), nullable=True),
    sa.Column('updated_by_id', sa.Integer(), nullable=True),
    sa.Column('created_by_email', sa.String(length=255), nullable=True),
    sa.Column('updated_by_email', sa.String(length=255), nullable=True),
    sa.ForeignKeyConstraint(['created_by_id'], ['users.id'], ),
    sa.ForeignKeyConstraint(['updated_by_id'], ['users.id'], ),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('stored_filename')
    )
    with op.batch_alter_table('audio_files', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_audio_files_file_hash'), ['file_hash'], unique=False)

    op.create_table('email_logs',
    sa.Column('id', sa.Integer(), nullable=False),
    sa.Column('tracking_id', sa.String(length=36), nullable=False),
    sa.Column('recipient_email', sa.String(length=255), nullable=False),
    sa.Column('user_id', sa.Integer(), nullable=True),
    sa.Column('email_type', sa.String(length=50), nullable=False),
    sa.Column('subject', sa.String(length=255), nullable=False),
    sa.Column('status', sa.String(length=20), nullable=True),
    sa.Column('language', sa.String(length=5), nullable=True),
    sa.Column('sent_at', sa.DateTime(), nullable=True),
    sa.Column('delivered_at', sa.DateTime(), nullable=True),
    sa.Column('opened_at', sa.DateTime(), nullable=True),
    sa.Column('clicked_at', sa.DateTime(), nullable=True),
    sa.Column('bounced_at', sa.DateTime(), nullable=True),
    sa.Column('provider', sa.String(length=50), nullable=True),
    sa.Column('provider_message_id', sa.String(length=255), nullable=True),
    sa.Column('error_message', sa.Text(), nullable=True),
    sa.Column('email_metadata', sa.JSON(), nullable=True),
    sa.Column('created_at', sa.DateTime(), nullable=True),
    sa.Column('updated_at', sa.DateTime(), nullable=True),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('tracking_id')
    )
    op.create_table('email_verifications',
    sa.Column('id', sa.Integer(), nullable=False),
    sa.Column('user_id', sa.Integer(), nullable=False),
    sa.Column('code', sa.String(length=6), nullable=False),
    sa.Column('token', sa.String(length=255), nullable=True),
    sa.Column('expires_at', sa.DateTime(), nullable=False),
    sa.Column('verified', sa.Boolean(), nullable=True),
    sa.Column('verification_type', sa.String(length=20), nullable=True),
    sa.Column('attempts', sa.Integer(), nullable=True),
    sa.Column('max_attempts', sa.Integer(), nullable=True),
    sa.Column('created_at', sa.DateTime(), nullable=True),
    sa.Column('verified_at', sa.DateTime(), nullable=True),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('token')
    )
    op.create_table('export_history',
    sa.Column('id', sa.Integer(), nullable=False),
    sa.Column('user_id', sa.Integer(), nullable=False),
    sa.Column('filename', sa.String(length=500), nullable=False),
    sa.Column('original_filename', sa.String(length=500), nullable=True),
    sa.Column('export_type', sa.String(length=100), nullable=False),
    sa.Column('format', sa.String(length=20), nullable=False),
    sa.Column('file_size', sa.Integer(), nullable=True),
    sa.Column('file_path', sa.String(length=1000), nullable=True),
    sa.Column('report_type', sa.String(length=100), nullable=True),
    sa.Column('date_range_start', sa.DateTime(), nullable=True),
    sa.Column('date_range_end', sa.DateTime(), nullable=True),
    sa.Column('selected_sections', postgresql.ARRAY(sa.String()), nullable=True),
    sa.Column('generation_parameters', postgresql.JSONB(astext_type=sa.Text()), nullable=True),
    sa.Column('status', sa.String(length=50), nullable=False),
    sa.Column('error_message', sa.Text(), nullable=True),
    sa.Column('download_count', sa.Integer(), nullable=False),
    sa.Column('last_downloaded_at', sa.DateTime(), nullable=True),
    sa.Column('expires_at', sa.DateTime(), nullable=True),
    sa.Column('title', sa.String(length=300), nullable=True),
    sa.Column('description', sa.Text(), nullable=True),
    sa.Column('language', sa.String(length=10), nullable=False),
    sa.Column('tags', postgresql.ARRAY(sa.String()), nullable=True),
    sa.Column('generation_time_seconds', sa.Float(), nullable=True),
    sa.Column('data_points_included', sa.Integer(), nullable=True),
    sa.Column('total_pages', sa.Integer(), nullable=True),
    sa.Column('created_at', sa.DateTime(), nullable=False),
    sa.Column('updated_at', sa.DateTime(), nullable=False),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_table('password_resets',
    sa.Column('id', sa.Integer(), nullable=False),
    sa.Column('user_id', sa.Integer(), nullable=False),
    sa.Column('code', sa.String(length=6), nullable=False),
    sa.Column('token', sa.String(length=255), nullable=True),
    sa.Column('expires_at', sa.DateTime(), nullable=False),
    sa.Column('used', sa.Boolean(), nullable=True),
    sa.Column('reset_type', sa.String(length=20), nullable=True),
    sa.Column('attempts', sa.Integer(), nullable=True),
    sa.Column('max_attempts', sa.Integer(), nullable=True),
    sa.Column('created_at', sa.DateTime(), nullable=True),
    sa.Column('used_at', sa.DateTime(), nullable=True),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('token')
    )
    op.create_table('research_progress',
    sa.Column('id', sa.Integer(), nullable=False),
    sa.Column('user_id', sa.Integer(), nullable=False),
    sa.Column('research_type', sa.String(length=100), nullable=False),
    sa.Column('milestone_name', sa.String(length=200), nullable=False),
    sa.Column('milestone_description', sa.Text(), nullable=True),
    sa.Column('target_date', sa.Date(), nullable=True),
    sa.Column('completion_date', sa.Date(), nullable=True),
    sa.Column('completion_percentage', sa.Float(), nullable=False),
    sa.Column('status', sa.String(length=50), nullable=False),
    sa.Column('thesis_chapter', sa.String(length=100), nullable=True),
    sa.Column('research_question', sa.Text(), nullable=True),
    sa.Column('methodology_notes', sa.Text(), nullable=True),
    sa.Column('findings_summary', sa.Text(), nullable=True),
    sa.Column('data_points_collected', sa.Integer(), nullable=False),
    sa.Column('models_tested', sa.Integer(), nullable=False),
    sa.Column('comparisons_completed', sa.Integer(), nullable=False),
    sa.Column('analysis_depth_score', sa.Float(), nullable=True),
    sa.Column('confidence_level', sa.Float(), nullable=True),
    sa.Column('peer_review_status', sa.String(length=50), nullable=True),
    sa.Column('supervisor_approval', sa.Boolean(), nullable=False),
    sa.Column('data_metadata', postgresql.JSONB(astext_type=sa.Text()), nullable=True),
    sa.Column('created_at', sa.DateTime(), nullable=False),
    sa.Column('updated_at', sa.DateTime(), nullable=False),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_table('templates',
    sa.Column('id', sa.Integer(), nullable=False),
    sa.Column('name', sa.String(length=200), nullable=False),
    sa.Column('description', sa.Text(), nullable=True),
    sa.Column('template_type', sa.String(length=50), nullable=False),
    sa.Column('content', sa.Text(), nullable=False),
    sa.Column('language', sa.String(length=10), nullable=False),
    sa.Column('category', sa.String(length=100), nullable=True),
    sa.Column('academic_domain', sa.String(length=100), nullable=True),
    sa.Column('prompt_template', sa.Text(), nullable=True),
    sa.Column('post_processing_rules', postgresql.JSONB(astext_type=sa.Text()), nullable=True),
    sa.Column('vocabulary_hints', postgresql.ARRAY(sa.String()), nullable=True),
    sa.Column('format_specifications', postgresql.JSONB(astext_type=sa.Text()), nullable=True),
    sa.Column('usage_count', sa.Integer(), nullable=False),
    sa.Column('success_rate', sa.Float(), nullable=True),
    sa.Column('average_improvement', sa.Float(), nullable=True),
    sa.Column('research_applications', postgresql.ARRAY(sa.String()), nullable=True),
    sa.Column('recommended_for', sa.Text(), nullable=True),
    sa.Column('limitations', sa.Text(), nullable=True),
    sa.Column('is_public', sa.Boolean(), nullable=False),
    sa.Column('created_by_user_id', sa.Integer(), nullable=True),
    sa.Column('is_active', sa.Boolean(), nullable=False),
    sa.Column('is_deleted', sa.Boolean(), nullable=False),
    sa.Column('created_at', sa.DateTime(), nullable=False),
    sa.Column('updated_at', sa.DateTime(), nullable=False),
    sa.Column('created_by_id', sa.Integer(), nullable=True),
    sa.Column('updated_by_id', sa.Integer(), nullable=True),
    sa.Column('created_by_email', sa.String(length=255), nullable=True),
    sa.Column('updated_by_email', sa.String(length=255), nullable=True),
    sa.ForeignKeyConstraint(['created_by_id'], ['users.id'], ),
    sa.ForeignKeyConstraint(['created_by_user_id'], ['users.id'], ondelete='SET NULL'),
    sa.ForeignKeyConstraint(['updated_by_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_table('user_analytics',
    sa.Column('id', sa.Integer(), nullable=False),
    sa.Column('user_id', sa.Integer(), nullable=False),
    sa.Column('date', sa.Date(), nullable=False),
    sa.Column('transcriptions_count', sa.Integer(), nullable=False),
    sa.Column('total_audio_duration', sa.Float(), nullable=False),
    sa.Column('total_processing_time', sa.Float(), nullable=False),
    sa.Column('average_accuracy_score', sa.Float(), nullable=True),
    sa.Column('total_words_transcribed', sa.Integer(), nullable=False),
    sa.Column('whisper_usage_count', sa.Integer(), nullable=False),
    sa.Column('wav2vec_usage_count', sa.Integer(), nullable=False),
    sa.Column('comparison_usage_count', sa.Integer(), nullable=False),
    sa.Column('voice_notes_created', sa.Integer(), nullable=False),
    sa.Column('voice_notes_transcribed', sa.Integer(), nullable=False),
    sa.Column('research_sessions', sa.Integer(), nullable=False),
    sa.Column('exports_generated', sa.Integer(), nullable=False),
    sa.Column('analysis_reports_viewed', sa.Integer(), nullable=False),
    sa.Column('average_whisper_wer', sa.Float(), nullable=True),
    sa.Column('average_wav2vec_wer', sa.Float(), nullable=True),
    sa.Column('greek_accuracy_score', sa.Float(), nullable=True),
    sa.Column('whisper_avg_processing_time', sa.Float(), nullable=True),
    sa.Column('wav2vec_avg_processing_time', sa.Float(), nullable=True),
    sa.Column('data_metadata', postgresql.JSONB(astext_type=sa.Text()), nullable=True),
    sa.Column('created_at', sa.DateTime(), nullable=False),
    sa.Column('updated_at', sa.DateTime(), nullable=False),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('user_id', 'date', name='uq_user_analytics_user_date')
    )
    op.create_table('user_sessions',
    sa.Column('user_id', sa.Integer(), nullable=False),
    sa.Column('jti', sa.String(length=36), nullable=False),
    sa.Column('expires_at', sa.DateTime(), nullable=False),
    sa.Column('ip_address', sa.String(length=45), nullable=True),
    sa.Column('user_agent', sa.Text(), nullable=True),
    sa.Column('id', sa.Integer(), nullable=False),
    sa.Column('is_active', sa.Boolean(), nullable=False),
    sa.Column('is_deleted', sa.Boolean(), nullable=False),
    sa.Column('created_at', sa.DateTime(), nullable=False),
    sa.Column('updated_at', sa.DateTime(), nullable=False),
    sa.Column('created_by_id', sa.Integer(), nullable=True),
    sa.Column('updated_by_id', sa.Integer(), nullable=True),
    sa.Column('created_by_email', sa.String(length=255), nullable=True),
    sa.Column('updated_by_email', sa.String(length=255), nullable=True),
    sa.ForeignKeyConstraint(['created_by_id'], ['users.id'], ),
    sa.ForeignKeyConstraint(['updated_by_id'], ['users.id'], ),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('jti')
    )
    with op.batch_alter_table('user_sessions', schema=None) as batch_op:
        batch_op.create_index('idx_user_sessions_jti', ['jti'], unique=False)
        batch_op.create_index('idx_user_sessions_user_id', ['user_id'], unique=False)

    op.create_table('transcriptions',
    sa.Column('audio_file_id', sa.Integer(), nullable=False),
    sa.Column('user_id', sa.Integer(), nullable=False),
    sa.Column('title', sa.String(length=255), nullable=True),
    sa.Column('description', sa.Text(), nullable=True),
    sa.Column('text', sa.Text(), nullable=True),
    sa.Column('language', sa.String(length=10), nullable=True),
    sa.Column('academic_notes', sa.Text(), nullable=True),
    sa.Column('status', sa.String(length=50), nullable=True),
    sa.Column('started_at', sa.DateTime(), nullable=True),
    sa.Column('completed_at', sa.DateTime(), nullable=True),
    sa.Column('error_message', sa.Text(), nullable=True),
    sa.Column('duration_seconds', sa.Float(), nullable=True),
    sa.Column('word_count', sa.Integer(), nullable=True),
    sa.Column('confidence_score', sa.Float(), nullable=True),
    sa.Column('model_used', sa.String(length=100), nullable=True),
    sa.Column('processing_metadata', postgresql.JSONB(astext_type=sa.Text()), nullable=True),
    sa.Column('whisper_text', sa.Text(), nullable=True),
    sa.Column('whisper_confidence', sa.Float(), nullable=True),
    sa.Column('whisper_processing_time', sa.Float(), nullable=True),
    sa.Column('wav2vec_text', sa.Text(), nullable=True),
    sa.Column('wav2vec_confidence', sa.Float(), nullable=True),
    sa.Column('wav2vec_processing_time', sa.Float(), nullable=True),
    sa.Column('comparison_metrics', postgresql.JSONB(astext_type=sa.Text()), nullable=True),
    sa.Column('ground_truth_text', sa.Text(), nullable=True),
    sa.Column('whisper_wer', sa.Float(), nullable=True),
    sa.Column('whisper_cer', sa.Float(), nullable=True),
    sa.Column('wav2vec_wer', sa.Float(), nullable=True),
    sa.Column('wav2vec_cer', sa.Float(), nullable=True),
    sa.Column('evaluation_completed', sa.Boolean(), nullable=False),
    sa.Column('evaluation_date', sa.DateTime(), nullable=True),
    sa.Column('evaluated_by_user_id', sa.Integer(), nullable=True),
    sa.Column('evaluation_notes', sa.Text(), nullable=True),
    sa.Column('academic_accuracy_score', sa.Float(), nullable=True),
    sa.Column('best_performing_model', sa.String(length=50), nullable=True),
    sa.Column('faster_model', sa.String(length=50), nullable=True),
    sa.Column('whisper_accuracy', sa.Float(), nullable=True),
    sa.Column('wav2vec_accuracy', sa.Float(), nullable=True),
    sa.Column('whisper_char_accuracy', sa.Float(), nullable=True),
    sa.Column('wav2vec_char_accuracy', sa.Float(), nullable=True),
    sa.Column('whisper_diacritic_accuracy', sa.Float(), nullable=True),
    sa.Column('wav2vec_diacritic_accuracy', sa.Float(), nullable=True),
    sa.Column('whisper_diacritic_errors', sa.Float(), nullable=True),
    sa.Column('wav2vec_diacritic_errors', sa.Float(), nullable=True),
    sa.Column('whisper_greek_char_accuracy', sa.Float(), nullable=True),
    sa.Column('wav2vec_greek_char_accuracy', sa.Float(), nullable=True),
    sa.Column('whisper_substitutions', sa.Integer(), nullable=True),
    sa.Column('whisper_deletions', sa.Integer(), nullable=True),
    sa.Column('whisper_insertions', sa.Integer(), nullable=True),
    sa.Column('wav2vec_substitutions', sa.Integer(), nullable=True),
    sa.Column('wav2vec_deletions', sa.Integer(), nullable=True),
    sa.Column('wav2vec_insertions', sa.Integer(), nullable=True),
    sa.Column('processing_cost_estimate', sa.Float(), nullable=True),
    sa.Column('id', sa.Integer(), nullable=False),
    sa.Column('is_active', sa.Boolean(), nullable=False),
    sa.Column('is_deleted', sa.Boolean(), nullable=False),
    sa.Column('created_at', sa.DateTime(), nullable=False),
    sa.Column('updated_at', sa.DateTime(), nullable=False),
    sa.Column('created_by_id', sa.Integer(), nullable=True),
    sa.Column('updated_by_id', sa.Integer(), nullable=True),
    sa.Column('created_by_email', sa.String(length=255), nullable=True),
    sa.Column('updated_by_email', sa.String(length=255), nullable=True),
    sa.ForeignKeyConstraint(['audio_file_id'], ['audio_files.id'], ),
    sa.ForeignKeyConstraint(['created_by_id'], ['users.id'], ),
    sa.ForeignKeyConstraint(['evaluated_by_user_id'], ['users.id'], ),
    sa.ForeignKeyConstraint(['updated_by_id'], ['users.id'], ),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_table('model_comparisons',
    sa.Column('id', sa.Integer(), nullable=False),
    sa.Column('user_id', sa.Integer(), nullable=False),
    sa.Column('audio_file_id', sa.Integer(), nullable=False),
    sa.Column('whisper_transcription_id', sa.Integer(), nullable=True),
    sa.Column('wav2vec_transcription_id', sa.Integer(), nullable=True),
    sa.Column('whisper_wer', sa.Float(), nullable=True),
    sa.Column('wav2vec_wer', sa.Float(), nullable=True),
    sa.Column('whisper_processing_time', sa.Float(), nullable=True),
    sa.Column('wav2vec_processing_time', sa.Float(), nullable=True),
    sa.Column('comparison_summary', sa.Text(), nullable=True),
    sa.Column('performance_metrics', sa.JSON(), nullable=True),
    sa.Column('academic_insights', sa.JSON(), nullable=True),
    sa.Column('created_at', sa.DateTime(), nullable=False),
    sa.Column('updated_at', sa.DateTime(), nullable=False),
    sa.ForeignKeyConstraint(['audio_file_id'], ['audio_files.id'], ),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ),
    sa.ForeignKeyConstraint(['wav2vec_transcription_id'], ['transcriptions.id'], ),
    sa.ForeignKeyConstraint(['whisper_transcription_id'], ['transcriptions.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_table('transcription_segments',
    sa.Column('transcription_id', sa.Integer(), nullable=False),
    sa.Column('start_time', sa.Float(), nullable=False),
    sa.Column('end_time', sa.Float(), nullable=False),
    sa.Column('text', sa.Text(), nullable=False),
    sa.Column('confidence', sa.Float(), nullable=True),
    sa.Column('speaker', sa.String(length=50), nullable=True),
    sa.Column('id', sa.Integer(), nullable=False),
    sa.Column('is_active', sa.Boolean(), nullable=False),
    sa.Column('is_deleted', sa.Boolean(), nullable=False),
    sa.Column('created_at', sa.DateTime(), nullable=False),
    sa.Column('updated_at', sa.DateTime(), nullable=False),
    sa.Column('created_by_id', sa.Integer(), nullable=True),
    sa.Column('updated_by_id', sa.Integer(), nullable=True),
    sa.Column('created_by_email', sa.String(length=255), nullable=True),
    sa.Column('updated_by_email', sa.String(length=255), nullable=True),
    sa.ForeignKeyConstraint(['created_by_id'], ['users.id'], ),
    sa.ForeignKeyConstraint(['transcription_id'], ['transcriptions.id'], ),
    sa.ForeignKeyConstraint(['updated_by_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    # ### end Alembic commands ###


def downgrade():
    # ### commands auto generated by Alembic - please adjust! ###
    op.drop_table('transcription_segments')
    op.drop_table('model_comparisons')
    op.drop_table('transcriptions')
    with op.batch_alter_table('user_sessions', schema=None) as batch_op:
        batch_op.drop_index('idx_user_sessions_user_id')
        batch_op.drop_index('idx_user_sessions_jti')

    op.drop_table('user_sessions')
    op.drop_table('user_analytics')
    op.drop_table('templates')
    op.drop_table('research_progress')
    op.drop_table('password_resets')
    op.drop_table('export_history')
    op.drop_table('email_verifications')
    op.drop_table('email_logs')
    with op.batch_alter_table('audio_files', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_audio_files_file_hash'))

    op.drop_table('audio_files')
    op.drop_table('users')
    op.drop_table('system_analytics')
    op.drop_table('model_performance')
    op.drop_table('language_metrics')
    op.drop_table('blacklist_tokens')
    # ### end Alembic commands ###
